<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="paddentrek, paddenoverzet, amfibie√´n tellen, vrijwilligers natuurpunt, paddenschermen, kikkers, salamanders, trekperiode, veldwerk, 2026">
    <meta name="description" content="Vrijwilligersapp voor paddentrek 2026: tel en registreer amfibie√´n, beheer tellingen en routes, deel rapporten en QR-export met je team.">
    <meta name="robots" content="index,follow">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f172a">
    <meta name="application-name" content="Paddentrek Teller Pro">
    <meta property="og:locale" content="nl_NL">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Paddentrek Teller Pro">
    <meta property="og:description" content="Sluit aan bij de paddentrek: tel en red amfibie√´n, houd tellingen bij en deel rapporten.">
    <meta property="og:image" content="/icons/icon-512.png">
    <meta property="og:image:alt" content="Kikkerpictogram van de Paddentrek app">
    <meta property="og:site_name" content="Paddentrek Teller Pro">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Paddentrek Teller Pro">
    <meta name="twitter:description" content="Vrijwilligersapp voor paddentrek en paddenoverzet: tel, registreer, deel.">
    <meta name="twitter:image" content="/icons/icon-512.png">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <title>Paddentrek Teller Pro</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='50' font-size='48'%3Eüê∏%3C/text%3E%3C/svg%3E">
    <!-- Local-first libraries; falls back to CDN if local vendor files are missing -->
    <script src="./vendor/tailwindcss.cdn.js"></script>
    <script>if(!window.tailwind){window.__cdnFallbackUsed=true;document.write('<script src="https://cdn.tailwindcss.com"><\/script>');}</script>
    <script src="./vendor/QRCode.js"></script>
    <script>if(typeof window.QRCode==='undefined'){window.__cdnFallbackUsed=true;document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"><\/script>');}</script>
    <script src="./vendor/html5-qrcode.js"></script>
    <script>if(typeof window.Html5Qrcode==='undefined'){window.__cdnFallbackUsed=true;document.write('<script src="https://unpkg.com/html5-qrcode"><\/script>');}</script>
    <script src="./version.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@600;700&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .active-tab { border-bottom: 3px solid #10b981; color: #10b981; }
        .counter-btn { transition: transform 0.1s active; position: relative; overflow: hidden; }
        .counter-btn:active { transform: scale(0.95); }
        .minus-btn { font-size: 0.8rem; }
        ::-webkit-scrollbar { display: none; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        #canvas-fx { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 100; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #update-btn { z-index: 120; }
        @keyframes recPulse { 0% { transform: scale(0.9); opacity: 0.6; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(0.9); opacity: 0.6; } }
        .animate-rec { animation: recPulse 1s infinite; }
        .record-btn { width: 34px; height: 34px; border-radius: 9999px; border: 1px solid rgba(248,113,113,0.5); background: rgba(248,113,113,0.12); display: inline-flex; align-items: center; justify-content: center; }
        .record-btn:active { transform: scale(0.96); }
        /* Emojis en letters */
        .icon-lg { font-size: 18px; line-height: 1; display: inline-block; color: #fff; vertical-align: -3px; }
        .icon-img { width: 24px; height: 24px; display: inline-block; vertical-align: -4px; }
        .brand-title { font-family: 'Orbitron', 'Inter', sans-serif; letter-spacing: 0.08em; text-transform: uppercase; }
        /* Determinatie checkboxes duidelijk zichtbaar, ook zonder Tailwind accent */
        .checkbox-det { width:16px; height:16px; border:1px solid #34d399; border-radius:4px; accent-color:#10b981; background:#0f172a; }
        .det-result-banner { background: linear-gradient(135deg,#10b981,#22d3ee); color:#0b1a13; padding:12px 14px; border-radius:12px; font-weight:800; font-size:15px; text-transform:uppercase; letter-spacing:0.02em; box-shadow:0 8px 24px rgba(16,185,129,0.25); }
        .det-thumb img { border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.35); }
        .det-question-wrap { display:flex; flex-direction:column; align-items:center; text-align:center; }
        .det-modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px); z-index:300; display:flex; align-items:center; justify-content:center; }
        .det-modal-card { background:#0f172a; border:1px solid rgba(16,185,129,0.35); border-radius:20px; padding:18px; max-width:420px; width:90%; box-shadow:0 20px 60px rgba(0,0,0,0.5); text-align:center; }
        .rarity-pill { display:inline-block; padding:4px 10px; border-radius:9999px; font-size:11px; font-weight:700; }
        .brand-wrap { display: flex; align-items: center; gap: 0.35rem; flex-wrap: wrap; }
        .brand-sub { white-space: nowrap; }
        @media (max-width: 480px) {
            .brand-wrap { flex-direction: column; align-items: flex-start; }
            .brand-sub { white-space: normal; margin-top: -4px; }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 pb-24">

    <canvas id="canvas-fx"></canvas>
    <input type="file" accept="image/*" capture="environment" onchange="handlePhoto(event)" id="photo-input" class="hidden">

    <!-- Header -->
    <header class="bg-gray-800 px-3 py-2 shadow-lg sticky top-0 z-50">
        <div class="flex justify-between items-center">
            <h1 class="text-lg font-bold text-white brand-wrap leading-tight">
                <span class="text-base">üê∏</span>
                <span class="text-emerald-400 brand-title text-base">Paddentrek Teller Pro</span>
                <span class="text-[10px] uppercase tracking-[0.18em] text-gray-400 brand-sub">Ultra Pro Xtreme 2026</span>
            </h1>
            <div class="flex flex-col items-end gap-1 text-[9px]">
                <div id="pwa-status" class="flex flex-col items-end gap-0.5 text-[9px] cursor-pointer" title="Offline gereed">
                    <div class="flex items-center gap-1 text-gray-400 bg-gray-900/60 px-2 py-1 rounded-full border border-gray-700">
                        <span id="status-icon" class="status-dot bg-gray-600"></span>
                        <span id="status-text" class="hidden"></span>
                    </div>
                    <div class="font-bold text-gray-500 uppercase tracking-tight">v<span id="app-version-display">11</span></div>
                </div>
                <button class="install-app-btn hidden bg-emerald-700 text-white px-3 py-1.5 rounded text-[10px] font-bold uppercase tracking-widest flex items-center gap-1">
                    üì≤ Installeer app
                </button>
            </div>
        </div>
        <div class="mt-2 flex flex-col gap-2">
            <div class="flex gap-2 items-center">
                <input type="date" id="datePicker" class="bg-gray-700 border-none rounded px-2 py-1.5 text-sm focus:ring-2 focus:ring-emerald-500 text-white w-full shadow-inner">
                <div class="flex items-center gap-1.5">
                    <button id="record-btn" onclick="stopTelling()" class="hidden record-btn" title="Stop telling">
                        <span id="record-dot" class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_0_6px_rgba(248,113,113,0.25)] animate-rec"></span>
                    </button>
                    <button id="new-session-btn" onclick="startTelling()" class="bg-emerald-700 px-3 py-2 rounded text-[10px] font-bold uppercase tracking-widest flex items-center gap-1">
                        <span class="text-xs">‚è∫</span> Nieuwe telling
                    </button>
                </div>
            </div>
        </div>
        
        <div id="undo-container" class="mt-2 hidden">
            <button onclick="undo()" class="w-full bg-orange-600/20 border border-orange-500 text-orange-400 text-[10px] py-2 rounded uppercase tracking-widest font-bold flex items-center justify-center gap-2 shadow-lg">
                ‚Ü©Ô∏è Herstel laatste tik
            </button>
        </div>
    </header>

    <!-- Navigatie -->
    <nav class="flex bg-gray-800 border-b border-gray-700 text-[10px] font-bold sticky top-[78px] z-40 overflow-x-auto whitespace-nowrap no-scrollbar shadow-md">
        <button onclick="switchTab('count')" id="tab-count" class="px-5 py-3 active-tab uppercase tracking-tight">üßÆ Tellen</button>
        <button onclick="switchTab('sessions')" id="tab-sessions" class="px-5 py-3 uppercase tracking-tight">üìí Logboek</button>
        <button onclick="switchTab('help')" id="tab-help" class="px-5 py-3 uppercase tracking-tight">üîç Determinatiehulp</button>
        <button onclick="switchTab('report')" id="tab-report" class="px-5 py-3 uppercase tracking-tight">üìä Rapport</button>
        <button onclick="switchTab('settings')" id="tab-settings" class="px-5 py-3 uppercase tracking-tight">‚öôÔ∏è Instellingen</button>
        <button onclick="switchTab('info')" id="tab-info" class="px-5 py-3 uppercase tracking-tight">‚ÑπÔ∏è Info</button>
    </nav>

    <main class="p-4">
        <button id="camera-fab" onclick="triggerPhoto()" class="fixed right-3 bottom-24 bg-purple-700 text-white w-12 h-12 rounded-full shadow-2xl flex items-center justify-center text-2xl z-[105] border border-purple-400/60">üì∏</button>
        <!-- TAB 1: TELLEN -->
        <section id="view-count" class="space-y-6">
            <!-- Start/Stop controls -->
            <div id="session-controls" class="text-center p-4">
                <div id="start-telling-container">
                    <button id="start-telling-btn" onclick="startTelling()" class="bg-emerald-600 text-white font-bold py-4 px-8 rounded-xl text-2xl shadow-lg active:bg-emerald-700">
                        Start Telling
                    </button>
                </div>
                <div id="stop-telling-container" class="hidden text-center">
                    <div id="session-timer" class="text-3xl font-mono text-emerald-400 mb-4 font-bold">00:00:00</div>
                    <button id="stop-telling-btn" onclick="stopTelling()" class="bg-red-600 text-white font-bold py-4 px-8 rounded-xl text-2xl shadow-lg active:bg-red-700">
                        Stop Telling
                    </button>
                </div>
            </div>

            <!-- Counters (hidden by default) -->
            <div id="counters-container" class="hidden">
                <div id="render-target" class="space-y-6"></div>
                <div id="custom-species-render" class="space-y-6"></div>

                <div class="bg-gray-800 p-6 rounded-xl border border-emerald-500/30 space-y-3">
                    <h3 class="font-bold mb-4 text-emerald-400">Nieuwe soort toevoegen</h3>
                    <div class="flex gap-2">
                        <input type="text" id="new-species-name" placeholder="Bijv: Groene Kikker..." class="flex-grow bg-gray-700 border-none rounded px-3 py-2 text-sm text-white">
                        <button onclick="addCustomSpecies()" class="bg-emerald-600 px-4 py-2 rounded font-bold text-sm">OK</button>
                    </div>
                    <div id="custom-species-list" class="space-y-2"></div>
                </div>
            </div>
            
            <button onclick="resetCurrentDate()" class="w-full py-8 text-gray-600 text-[10px] uppercase tracking-widest font-bold border-2 border-dashed border-gray-800 rounded-xl mt-10">
                Alles wissen voor vandaag
            </button>
        </section>

        <!-- TAB 2: SESSIE LOG -->
        <section id="view-sessions" class="hidden space-y-4">
            <div class="flex items-center gap-2 text-[11px] text-gray-300 bg-gray-800/70 border border-gray-700 px-3 py-2 rounded">
                <span class="uppercase font-bold text-gray-400 text-[10px]">Telling</span>
                <select id="session-log-select" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 flex-1 text-white text-[11px]" onchange="setViewedSession(this.value)"></select>
            </div>
            <div class="text-[11px] text-gray-400">
                Beheer per telling: weer, trajectnaam, notities en foto's.
            </div>
            <datalist id="route-suggestions"></datalist>
            <div id="session-log-container" class="space-y-4"></div>
            <div class="pt-1">
                <button onclick="switchTab('report')" class="w-full bg-emerald-700 hover:bg-emerald-600 text-white py-3 rounded-xl font-bold text-xs uppercase tracking-widest shadow-lg">
                    üìä Naar rapportage & delen
                </button>
            </div>
        </section>

        <!-- TAB 4: RAPPORT -->
        <section id="view-report" class="hidden space-y-6 text-center">
            <div class="bg-gray-800 p-4 rounded-xl border border-emerald-500/30 space-y-3 text-left">
                <div class="flex items-center gap-2 text-[10px] text-gray-300">
                    <span>Telling:</span>
                    <select id="report-session-select" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 flex-1 text-left text-white" onchange="updateReport()"></select>
                    <button class="text-[10px] bg-gray-700 px-2 py-1 rounded" onclick="setReportMode('session')">Per telling</button>
                    <button class="text-[10px] bg-gray-700 px-2 py-1 rounded" onclick="setReportMode('day')">Hele dag</button>
                </div>
                <div id="report-text" class="bg-gray-900 p-3 rounded-lg font-mono text-left text-[11px] border border-emerald-500/30 whitespace-pre-wrap leading-relaxed"></div>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="copyReport()" class="w-full bg-emerald-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg active:bg-emerald-700 text-xs uppercase tracking-widest">
                        üìã Kopieer rapport
                    </button>
                    <button onclick="shareReport()" class="w-full bg-purple-700 py-3 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg active:bg-purple-800 text-xs uppercase tracking-widest">
                        üì§ Deel rapport
                    </button>
                    <button onclick="shareReport(true)" class="w-full bg-purple-900/70 border border-purple-400/30 py-3 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg active:bg-purple-900 text-xs uppercase tracking-widest">
                        üì∏ Deel met foto's
                    </button>
                    <button onclick="exportReportCSV()" class="w-full bg-indigo-600 py-3 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg active:bg-indigo-700 text-xs uppercase tracking-widest">
                        ‚¨áÔ∏è Exporteer CSV van vandaag
                    </button>
                </div>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-purple-500/30 space-y-3 text-left">
                <div class="flex items-center justify-between">
                    <h3 class="font-bold text-purple-200 text-sm">Determinaties</h3>
                    <button onclick="shareDeterminaties()" class="bg-purple-700 px-3 py-2 rounded text-[11px] font-bold uppercase tracking-widest">üì§ Deel</button>
                </div>
                <div id="report-dets" class="space-y-2 text-[11px] text-gray-200"></div>
            </div>
        </section>

        <!-- TAB 6: INSTELLINGEN -->
        <section id="view-settings" class="hidden space-y-4">
            <h2 class="text-xl font-bold text-emerald-400 text-center">‚öôÔ∏è Instellingen</h2>
            <div class="bg-gray-800 p-4 rounded-xl border border-emerald-500/30 space-y-3">
                <h3 class="font-bold text-emerald-300 text-sm">Tellingbeheer</h3>
                <div class="flex gap-2 items-center">
                    <input type="date" id="sessionDate" class="bg-gray-700 border-none rounded px-2 py-1.5 text-sm focus:ring-2 focus:ring-emerald-500 text-white w-full shadow-inner">
                    <button onclick="startSession(true, true)" class="bg-emerald-700 px-3 py-2 rounded text-[10px] font-bold uppercase tracking-widest">Start op datum</button>
                </div>
                <div id="session-admin-list" class="space-y-2 text-[11px]"></div>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-purple-500/30 space-y-3">
                <h3 class="font-bold mb-2 text-purple-300">Export & Import (QR)</h3>
                <div class="flex gap-2 mb-2 text-[10px] text-gray-300 items-center">
                    <span>Data:</span>
                    <select id="qr-session-select" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 flex-1 text-left text-white" onchange="generateQR();updateQrSummary();"></select>
                </div>
                <div class="flex flex-col md:flex-row gap-3 items-start">
                    <div id="qrcode-area" class="bg-white p-3 rounded-lg inline-block mx-auto md:mx-0 border-4 border-purple-500"></div>
                    <div class="flex-1 text-[11px] text-gray-100 bg-gray-900/60 border border-gray-700 rounded p-3 space-y-1" id="qr-summary-box">
                        <div class="font-bold text-purple-200">Wanneer gebruiken?</div>
                        <div>‚Ä¢ Met twee (of meer) tellers die tegelijk op een ander stuk van het traject zitten.</div>
                        <div>‚Ä¢ E√©n toestel maakt de QR (bron), de anderen scannen (ontvanger).</div>
                        <div class="font-bold text-purple-200 pt-1">Hoe?</div>
                        <div>1) Kies hierboven welke data je deelt (hele dag of 1 telling).</div>
                        <div>2) Tik op Refresh QR en toon de code.</div>
                        <div>3) Op het andere toestel: kies ‚ÄúBijtellen in‚Äù, tik ‚ÄúScan QR‚Äù en scan.</div>
                        <div class="text-purple-300 pt-1">Er worden enkel aantallen gedeeld, geen foto‚Äôs.</div>
                    </div>
                </div>
                <button onclick="generateQR()" class="w-full bg-purple-600 py-3 rounded-lg font-bold uppercase text-xs">Refresh QR</button>
                <div class="h-px bg-purple-500/30 my-2"></div>
                <h4 class="text-purple-200 font-bold text-sm">Importeer</h4>
                <div class="text-[11px] text-gray-200 mb-2 space-y-1">
                    <div><strong class="text-purple-200">Gebruik:</strong> samen tellen en nadien alle aantallen optellen.</div>
                    <div>1) Kies hierboven de bron (dag of telling) en toon de QR.</div>
                    <div>2) Kies hieronder waar je wil bijtellen op dit toestel (dag of telling).</div>
                    <div>3) Tik ‚ÄúScan QR‚Äù en richt op de code van de andere teller.</div>
                    <div class="text-purple-300">Alleen aantallen gaan mee, geen foto‚Äôs.</div>
                </div>
                <label class="text-[10px] text-gray-300 font-bold uppercase">Bijtellen in</label>
                <select id="import-target-select" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white w-full text-[12px]" onchange="updateImportTargetHint()"></select>
                <div id="import-target-hint" class="text-[11px] text-gray-400 bg-gray-900/70 border border-gray-700 rounded px-2 py-2"></div>
                <button onclick="startSessionScanner()" class="w-full bg-purple-600 py-3 rounded-lg font-bold uppercase text-xs">Scan QR</button>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-indigo-500/30 space-y-3">
                <h3 class="font-bold text-indigo-300 text-sm">CSV Import</h3>
                <p class="text-[11px] text-gray-300">Importeer CSV‚Äôs zoals je ze exporteert (kolommen: Datum; Soort; Koppels levend; Koppels dood; M/V/Onb levend/dood).</p>
                <input type="file" accept=".csv,text/csv" id="csv-import-input" class="block w-full text-[11px] text-gray-300 bg-gray-700 border border-gray-600 rounded px-2 py-2">
                <button onclick="handleCSVImport()" class="w-full bg-indigo-600 py-3 rounded-lg font-bold uppercase text-xs">‚¨ÜÔ∏è Importeer CSV</button>
                <div id="csv-import-result" class="text-[10px] text-gray-400"></div>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-indigo-400/30 space-y-3">
                <h3 class="font-bold text-indigo-200 text-sm">CSV Export</h3>
                <p class="text-[11px] text-gray-300">Exporteer dag of telling van de huidige datum, of een datumrange.</p>
                <div class="grid grid-cols-2 gap-2 text-[11px] text-gray-200">
                    <div class="space-y-1">
                        <label class="uppercase tracking-wide text-[9px] text-gray-400">Van</label>
                        <input type="date" id="csv-from-settings" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white w-full">
                    </div>
                    <div class="space-y-1">
                        <label class="uppercase tracking-wide text-[9px] text-gray-400">Tot</label>
                        <input type="date" id="csv-to-settings" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white w-full">
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-2">
                    <button onclick="exportAllSessionsCSV()" class="w-full bg-indigo-600 py-2 rounded-lg font-bold uppercase text-xs">‚¨áÔ∏è Exporteer alle tellingen (vandaag)</button>
                    <button onclick="exportRangeCSV(true)" class="w-full bg-indigo-500 py-2 rounded-lg font-bold uppercase text-xs">‚¨áÔ∏è Exporteer alle tellingen (range)</button>
                </div>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-amber-500/30 space-y-3">
                <h3 class="font-bold text-amber-200 text-sm flex items-center gap-2">Dev: Storage inspector <span class="text-[9px] bg-amber-500/20 border border-amber-400/30 text-amber-100 px-2 py-1 rounded">Alleen lokaal</span></h3>
                <p class="text-[11px] text-gray-300">Bekijk wat er precies in <code>localStorage</code> staat. Handig om te controleren of foto-data er nog is na een update.</p>
                <div class="flex gap-2 items-center text-[11px]">
                    <input id="storage-search" type="text" placeholder="Zoek in keys of inhoud" class="flex-1 bg-gray-700 border border-gray-600 rounded px-2 py-2 text-white" oninput="renderStorageInspector()">
                    <button onclick="renderStorageInspector(true)" class="bg-amber-600 px-3 py-2 rounded font-bold text-[11px] uppercase tracking-widest">Herlaad</button>
                </div>
                <div id="storage-meta" class="text-[10px] text-gray-400"></div>
                <div id="storage-inspector" class="space-y-2 max-h-72 overflow-auto no-scrollbar text-[11px]"></div>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-red-500/30 space-y-3">
                <h3 class="font-bold text-red-300 text-sm">Databeheer foto's</h3>
                <div class="flex items-center gap-2">
                    <input type="date" id="photo-clean-date" class="bg-gray-700 border-none rounded px-2 py-1.5 text-sm focus:ring-2 focus:ring-emerald-500 text-white w-full shadow-inner" value="">
                    <button onclick="clearAllPhotos(document.getElementById('photo-clean-date').value || picker.value)" class="bg-red-800 px-3 py-2 rounded text-[10px] text-white">Wis dag</button>
                </div>
                <button onclick="clearAllPhotos()" class="w-full bg-red-900/40 border border-red-700 text-red-200 py-2 rounded text-[11px]">Wis alle foto's</button>
            </div>
        </section>

        <!-- TAB 7: DETERMINATIEHULP -->
        <section id="view-help" class="hidden space-y-4 text-sm">
            <h2 class="text-xl font-bold text-emerald-400 text-center">üîç Determinatiehulp</h2>

            <!-- Foto capture + preview -->
            <input type="file" accept="image/*" capture="environment" id="det-photo-input" class="hidden" onchange="handleDetPhoto(event)">
            <div class="bg-gray-800 p-4 rounded-xl border border-emerald-500/30 space-y-3">
                <div class="flex items-center justify-between gap-2">
                    <div>
                        <div class="text-[11px] uppercase text-gray-400 font-bold">Actieve telling</div>
                        <div id="det-session-label" class="text-sm text-white">Geen telling</div>
                    </div>
                    <div class="flex gap-2">
                        <button id="det-start-session-btn" onclick="startSession(true)" class="bg-emerald-700 px-3 py-2 rounded text-[10px] font-bold uppercase tracking-widest">Start telling</button>
                        <button id="det-loose-btn" onclick="startLooseDetermination()" class="bg-amber-700 px-3 py-2 rounded text-[10px] font-bold uppercase tracking-widest hidden">Start losse determinatie</button>
                        <button id="det-new-btn" onclick="beginDetermination()" class="bg-purple-700 px-3 py-2 rounded text-[10px] font-bold uppercase tracking-widest">Nieuwe determinatie</button>
                    </div>
                </div>

                <!-- Foto's bovenaan -->
                <div class="bg-gray-900/60 border border-gray-700 rounded-lg p-3 space-y-2">
                    <div class="flex items-center justify-between text-[10px] uppercase text-gray-400 font-bold">
                        <span>Foto's (max 3)</span>
                        <button onclick="triggerDetPhoto()" class="bg-emerald-600 hover:bg-emerald-500 px-4 py-2 rounded-lg text-[11px] text-white font-bold shadow">üì∏ Voeg foto toe</button>
                    </div>
                    <div id="det-photo-strip" class="grid grid-cols-3 gap-2"></div>
                    <div class="text-[10px] text-gray-400">üì∏ Voeg hier foto's toe voor betere determinatie. Tik op een foto om te vergroten.</div>
                </div>

                <!-- Vraagkaart -->
                <div id="det-question-card" class="bg-gray-900/60 border border-gray-700 rounded-lg p-3 space-y-3 hidden det-question-wrap">
                    <div class="text-[10px] uppercase text-gray-400 font-bold">Vraag</div>
                    <div class="flex flex-col md:flex-row gap-3 items-start">
                        <div class="flex-1 space-y-2 det-question-wrap">
                            <div id="det-question" class="text-base font-bold text-white min-h-[48px] flex items-center justify-center text-center">Start een determinatie.</div>
                            <div id="det-answer-buttons" class="grid grid-cols-2 gap-4 px-4">
                                <button id="det-btn-yes" onclick="answerDetermination('yes')" class="bg-emerald-700 hover:bg-emerald-600 text-white py-3 px-4 rounded-xl font-bold uppercase text-sm disabled:opacity-40">JA</button>
                                <button id="det-btn-no" onclick="answerDetermination('no')" class="bg-red-700 hover:bg-red-600 text-white py-3 px-4 rounded-xl font-bold uppercase text-sm disabled:opacity-40">NEE</button>
                            </div>
                            <div id="det-progress" class="text-[10px] text-gray-400"></div>
                            <div id="det-result" class="space-y-2"></div>
                            <div id="det-next-hint" class="text-[11px] text-gray-400 text-center hidden">Klik bovenaan op Nieuwe determinatie om opnieuw te beginnen.</div>
                            <div id="det-thumb-box" class="det-thumb hidden">
                                <img id="det-thumb-img" src="" alt="Soort afbeelding" class="w-full max-w-sm mx-auto object-cover">
                            </div>
                        <div id="det-apply" class="hidden space-y-2">
                            <button onclick="applyDeterminationToCounts()" class="w-full bg-emerald-600 py-3 px-8 rounded-lg font-bold uppercase text-sm">Voeg toe aan teller</button>
                            <div id="det-warning" class="text-[10px] text-orange-300 bg-orange-900/30 border border-orange-700 rounded p-2 hidden">Let op: bij her-determinatie wordt de vorige telling niet automatisch gecorrigeerd. Pas zelf -1/+1 aan indien nodig.</div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historiek / bewerken -->
            <div class="bg-gray-800 p-4 rounded-xl border border-blue-500/30 space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="font-bold text-blue-200 text-sm">Determinaties in deze telling</h3>
                    <select id="det-session-select" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-[11px]" onchange="renderDetSessionOptions(); renderDeterminationUI(); renderDeterminationList();"></select>
                </div>
                <div id="det-list" class="space-y-2 text-[11px]"></div>
            </div>
        </section>

        <!-- TAB 8: INFO -->
        <section id="view-info" class="hidden space-y-4 text-sm">
            <h2 class="text-xl font-bold text-emerald-400 text-center">‚ÑπÔ∏è Info & Hulp</h2>
            <button class="install-app-btn hidden w-full bg-emerald-700 text-white px-3 py-2 rounded text-[11px] font-bold uppercase tracking-widest">
                üì≤ Installeer app
            </button>
            <div class="bg-gray-800 p-4 rounded-xl border border-emerald-500/30 space-y-3">
                <h3 class="font-bold text-emerald-300 text-sm">üê∏ Tellen (stap voor stap)</h3>
                <ul class="list-disc list-inside text-gray-200 space-y-1">
                    <li>Kies eerst een datum bovenaan.</li>
                    <li>Start daarna een telling en begin te tellen.</li>
                    <li>Links tel je levende dieren. Rechts tel je dode dieren.</li>
                    <li>Een paartje telt automatisch als 2 dieren.</li>
                    <li>Foto maken kan met de cameraknop.</li>
                </ul>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-blue-500/30 space-y-3">
                <h3 class="font-bold text-blue-300 text-sm">üïí Tellingen & logboek</h3>
                <ul class="list-disc list-inside text-gray-200 space-y-1">
                    <li>Een telling is een telmoment (bijvoorbeeld deel 1 en deel 2 van je avond).</li>
                    <li>In het logboek zie je per telling: totaal, weer, route, foto's en determinaties.</li>
                    <li>Tik op een foto om die groot te bekijken.</li>
                    <li>Je kan een telling delen of verwijderen via Instellingen ‚Üí Tellingbeheer.</li>
                </ul>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-purple-500/30 space-y-3">
                <h3 class="font-bold text-purple-300 text-sm">üì§ Rapport delen</h3>
                <ul class="list-disc list-inside text-gray-200 space-y-1">
                    <li>Kies of je 1 telling of de hele dag wil delen.</li>
                    <li>Je kan delen met of zonder foto's.</li>
                    <li>Gebruik de deelknop om te sturen via WhatsApp of een andere app.</li>
                </ul>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-amber-500/30 space-y-3">
                <h3 class="font-bold text-amber-300 text-sm">üî≥ QR import (samen tellen)</h3>
                <div class="text-gray-200 text-[13px] leading-relaxed space-y-2">
                    <div><strong>Wat is het?</strong> Een snelle manier om tellingen van meerdere mensen te bundelen zonder csv.</div>
                    <div><strong>Voorbeeld:</strong> Leo en Sarah tellen elk een deel van de route. Ze willen alles op Sarah haar gsm samenleggen.</div>
                    <div class="space-y-1 bg-gray-900/60 border border-amber-400/30 rounded p-3 text-[12px]">
                        <div>1) Leo opent Instellingen ‚Üí Export & Import (QR) en tikt op ‚ÄúRefresh QR‚Äù.</div>
                        <div>2) Sarah opent dezelfde pagina, kiest bij ‚ÄúBijtellen in‚Äù haar telling (bv. 20:51) en tikt ‚ÄúScan QR‚Äù.</div>
                        <div>3) Sarah scant Leo‚Äôs code. Leo‚Äôs aantallen worden bij haar gekozen telling opgeteld.</div>
                        <div class="text-amber-200">Resultaat: Sarah heeft de volledige telling, Leo behoudt zijn eigen data.</div>
                    </div>
                    <div><strong>Belangrijk:</strong> alleen aantallen worden gedeeld; foto‚Äôs blijven op het toestel.</div>
                </div>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-red-500/30 space-y-3">
                <h3 class="font-bold text-red-300 text-sm">üíæ Data & offline</h3>
                <ul class="list-disc list-inside text-gray-200 space-y-1">
                    <li>Je gegevens staan lokaal op je toestel (in de browser).</li>
                    <li>Na de eerste keer werkt de app ook zonder internet.</li>
                    <li>Via Instellingen kan je foto's van 1 dag of alles wissen.</li>
                    <li>Let op: verwijderen kan niet ongedaan gemaakt worden.</li>
                </ul>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-gray-600/40 space-y-2">
                <h3 class="font-bold text-gray-200 text-sm">‚úÖ Snelle start</h3>
                <p class="text-gray-300 text-[12px]">1) Start telling ‚Üí 2) Tel dieren ‚Üí 3) Voeg foto's toe ‚Üí 4) Stop telling ‚Üí 5) Deel rapport.</p>
            </div>
            <p class="text-[11px] text-gray-500 text-center mt-2">App gemaakt door Jasper Cuvelier.</p>
        </section>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-emerald-600 text-white px-6 py-3 rounded-full shadow-2xl hidden z-[110] transition-all opacity-0 font-bold border border-emerald-400/30">
        Actie gelukt!
    </div>
    <button id="update-btn" class="hidden fixed right-4 bottom-24 bg-emerald-600 text-white px-4 py-2 rounded-full shadow-2xl font-bold text-xs uppercase tracking-widest border border-emerald-300/40">
        UPDATE
    </button>
    <!-- Determinatie modal -->
    <div id="det-modal" class="det-modal-backdrop hidden" onclick="closeDetModal(event)">
        <div class="det-modal-card relative space-y-3" onclick="event.stopPropagation();">
            <button class="absolute right-3 top-3 text-gray-400 text-lg" onclick="closeDetModal(event)">‚úï</button>
            <div id="det-modal-title" class="text-2xl font-extrabold text-white">Determinatie</div>
            <div id="det-modal-rarity" class="rarity-pill bg-emerald-900 text-emerald-200"></div>
            <div id="det-modal-links" class="space-y-2">
                <button id="det-modal-link" onclick="openDetLink('wiki')" class="w-full bg-emerald-900/40 text-emerald-100 border border-emerald-600/50 py-2 rounded text-sm hidden">Wikipedia zoekopdracht</button>
                <button id="det-modal-link-np" onclick="openDetLink('np')" class="w-full bg-blue-900/40 text-blue-100 border border-blue-600/50 py-2 rounded text-sm hidden">Natuurpunt soortfiche</button>
            </div>
            <div class="space-y-2 pt-2">
                <button id="det-modal-add" class="bg-emerald-600 text-white py-2 rounded-lg font-bold uppercase text-xs w-full" onclick="applyDeterminationToCounts(); closeDetModal();">Voeg toe aan teller</button>
                <button class="bg-gray-700 text-white py-2 rounded-lg font-bold uppercase text-xs w-full" onclick="closeDetModal()">Ok</button>
            </div>
        </div>
    </div>

    <!-- Photo lightbox -->
    <div id="photo-lightbox" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-[200] flex items-center justify-center p-4" onclick="closePhoto(event)">
        <div class="relative max-w-4xl max-h-[90vh] w-full flex justify-center">
            <img id="photo-lightbox-img" src="" class="rounded-xl shadow-2xl max-h-[90vh] object-contain bg-black" alt="Foto">
            <button class="absolute top-2 right-2 bg-black/60 text-white rounded-full w-10 h-10 font-bold text-lg" onclick="closePhoto(event)">‚úï</button>
        </div>
    </div>

    <!-- QR scan modal -->
    <div id="qr-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden z-[210] flex items-center justify-center p-4" onclick="closeQrModal(event)">
        <div class="bg-gray-900 rounded-xl border border-purple-500/40 w-full max-w-md p-4 relative">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-purple-200 font-bold text-sm">QR Scan</h3>
                <button class="bg-black/50 text-white rounded-full w-8 h-8" onclick="closeQrModal(event)">‚úï</button>
            </div>
            <div id="session-reader-modal" class="rounded-lg overflow-hidden bg-black aspect-square"></div>
            <div class="text-[10px] text-gray-400 mt-2">Richt de camera op de QR-code.</div>
        </div>
    </div>

    <!-- Session info modal -->
    <div id="session-info-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden z-[220] flex items-center justify-center p-4" onclick="event.target.id==='session-info-modal' && closeSessionInfoModal()">
        <div class="bg-gradient-to-br from-gray-900 via-gray-850 to-gray-800 border border-emerald-500/40 shadow-2xl rounded-2xl max-w-md w-full p-5 space-y-4 relative">
            <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-full bg-emerald-600/20 border border-emerald-400/40 flex items-center justify-center text-xl">üìù</div>
                <div class="space-y-1">
                    <h3 class="text-emerald-200 font-bold text-lg">Telling afronden</h3>
                    <div class="text-gray-200 text-sm leading-relaxed space-y-1.5">
                        <div><span class="text-emerald-300 font-semibold">1.</span> Vul het traject dat je zojuist liep in.</div>
                        <div><span class="text-emerald-300 font-semibold">2.</span> Controleer het weerbericht (aangepast mag, we vullen alvast je locatie in).</div>
                        <div><span class="text-emerald-300 font-semibold">3.</span> Notities: vermeld bijv. of het wegdek nat of droog was (natte weg = vaak meer trek), plus eventuele bijzonderheden.</div>
                        <div class="text-gray-400 text-[13px] pt-1">Deze info gaat mee in het rapport en helpt bij latere tellingen.</div>
                    </div>
                </div>
                <button class="absolute top-3 right-3 text-gray-400 hover:text-white" onclick="closeSessionInfoModal()">‚úï</button>
            </div>
            <div class="flex gap-3 flex-wrap">
                <button class="flex-1 min-w-[120px] bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg py-2.5 font-bold text-sm shadow-lg active:scale-[0.98]" onclick="switchTab('sessions'); closeSessionInfoModal();">
                    Naar logboek
                </button>
                <button class="flex-1 min-w-[120px] bg-gray-800 border border-gray-700 text-gray-200 rounded-lg py-2.5 font-bold text-sm active:scale-[0.98]" onclick="closeSessionInfoModal()">
                    Later
                </button>
            </div>
        </div>
    </div>

    <script src="./app.js"></script>
</body>
</html>
